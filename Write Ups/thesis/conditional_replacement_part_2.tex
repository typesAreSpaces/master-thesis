\begin{algorithm}[!ht]\label{conditional_replacement_part_2_impl}
  \caption{Conditional Replacment - Part 2}
  \linespread{\separationline}\selectfont
  \begin{algorithmic}[2]
    \Procedure {Conditional Replacement} {z3::expr const \& x, z3::expr const \& y, H : Horn clauses, $\mathcal{E}$ : conditional equivalence relation}

    \If {x is of the form $f_x(t_1, \dots, t_{k_1})$ and y is of the form $f_y(t_1^{'}, \dots, t_{k_2}^{'})$}
    \For {$\sigma_{f_x}$ in Candidates($f_x(t_1, \dots, t_{k_1})$)}
    \For {$\sigma_{f_y}$ in Candidates($f_y(t_1^{'}, \dots, t_{k_2}^{'})$)}
    \State {horn\_clause.add(ExtendedExplain($f_x(t_1, \dots, t_{k_1})$, $\sigma_{f_x}$, H, $\mathcal{E}$) + ExtendedExplain($f_y(t_1^{'}, \dots, t_{k_2}^{'})$, $\sigma_y$, H, $\mathcal{E}$), $\sigma_{f_x} = \sigma_{f_y})$}
    \EndFor
    \For {$arguments_{f_y}$ in CartesianProd(AllCandidates($f_y(t_1^{'}, \dots, t_{k_2}^{'})$))}
    \State {horn\_clause.add(ExtendedExplain($f_x(t_1, \dots, t_{k_1})$, $\sigma_{f_x}$, H, $\mathcal{E}$) + $\sum_{i=1}^{k_2}$ ExtendedExplain($t_i^{'}$, $arguments_{f_y}[i]$, H, $\mathcal{E}$), $\sigma_{f_x} = f_y(arguments_{f_y})$)}
    \EndFor
    \EndFor

    \For {$arguments_{f_x}$ in CartesianProd(AllCandidates($f_x(t_1, \dots, t_{k_1})$))}
    \For {$\sigma_{f_y}$ in Candidates($f_y(t_1^{'}, \dots, t_{k_2}^{'})$)}
    \State {horn\_clause.add($\sum_{i=1}^{k_1}$ ExtendedExplain($t_i$, $arguments_{f_x}[i]$, H, $\mathcal{E}$) + ExtendedExplain($f_y(t_1^{'}, \dots, t_{k_2}^{'})$, $\sigma_y$, H, $\mathcal{E}$), $f_x(arguments_{f_x}) = \sigma_{f_y})$}
    \EndFor
    \For {$arguments_{f_y}$ in CartesianProd(AllCandidates($f_y(t_1^{'}, \dots, t_{k_2}^{'})$))}
    \State {horn\_clause.add($\sum_{i=1}^{k_1}$ ExtendedExplain($t_i$, $arguments_{f_x}[i]$, H, $\mathcal{E}$) + $\sum_{i=1}^{k_2}$ ExtendedExplain($t_i^{'}$, $arguments_{f_y}[i]$, H, $\mathcal{E}$), $f_x(arguments_{f_x}) = f_y(arguments_{f_y})$)}
    \EndFor
    \EndFor

    \EndIf

    \EndProcedure
  \end{algorithmic}
\end{algorithm}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
